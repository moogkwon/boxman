<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="notice">

	<insert id="insertUploadNotice" parameterType="upNotice">
		INSERT INTO UPNOTICE VALUES(seq_upNotice.nextval, #{nNo}, #{upNoticeOrgName}, #{upNoticeReName})
	</insert>

	<insert id="insertNotice" parameterType="map">
		insert into notice values(seq_notice.nextval, (select deptNo from department where deptName=#{deptName}), #{nCheck}, #{nName}, #{nText}, default, sysdate)
		<selectKey keyProperty="nNo" resultType="string" order="AFTER">
			SELECT seq_notice.CURRVAL FROM DUAL
		</selectKey>
	</insert>
	
	<insert id="insertSite" parameterType="map">
		insert into rsite values(seq_rsite.nextval, #{stName}, #{stCheck}, #{stLink})
	</insert>

	<select id="selectNoticeOne" resultType="notice">
		select A.* , B.deptname from notice A , department B where A.deptNo = B.deptNo AND nName=#{nName}
	</select>
	
	<select id="selectNoticeCount" resultType="_int">
		select count(*) from notice
	</select>

	<select id="selectNoticeList" resultType="map">
		select a.*,(select count(*)
					 from upNotice
					 where nNo=a.nNo) as upNoticeCount
					 from notice a order by nDate desc
	</select>

	<update id="updateReadCount" parameterType="_int">
	  UPDATE NOTICE SET NREADCOUNT = NREADCOUNT + 1 WHERE NNO = #{nReadCount}
	</update>
	
	<select id="selectUpNoticeList" resultType="upNotice" parameterType="_int">
 		select * from upnotice where NNO=#{NNo}
 	</select>
 	
 	<select id="selectNoticeList2" resultType="notice">
 		select * from notice where NCHECK='필독체크'
 	</select>
 	
 	<select id="selectSiteList" resultType="map">
 		select * from rsite
 	</select>

</mapper>
